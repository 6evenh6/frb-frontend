<div class="container-fluid mt-4">
  <div class="d-flex align-items-center justify-content-between mb-3">
    <div class="d-flex align-items-center mb-3">
      <div>
        <h2 class="fw-bold text-primary mb-0 d-flex align-items-center gap-2">
          Usuários
          <span class="icon-wrapper bg-light rounded-circle d-flex align-items-center justify-content-center"
            style="width: 42px; height: 42px;">
            <i class="bi {{ iconeAtual }} text-secondary fs-4 animated-icon"></i>
          </span>
        </h2>
        <small class="text-muted">Gerencie os usuários do sistema com diferentes perfis de acesso.</small>
      </div>
    </div>
    <button class="btn btn-success" (click)="abrirFormulario()">
      <i class="bi bi-plus-circle-fill me-1"></i>
      Novo Cadastro
    </button>
  </div>

  <!-- Formulário -->
  <div *ngIf="exibirFormulario" class="card mb-4 animate__animated animate__fadeIn">
    <div class="card-header">Formulário de Usuário</div>
    <div class="card-body">
      <form #formUsuarios="ngForm" (ngSubmit)="salvarUsuario(formUsuarios)">
        <div class="row">
          <div class="col-md-4 mb-3">
            <label class="form-label">Tipo de Usuário</label>
            <select class="form-select" name="tipo" [(ngModel)]="modelo.tipo" required>
              <option [ngValue]="TipoUsuario.Administrador">Administrador</option>
              <option [ngValue]="TipoUsuario.Operador">Operador</option>
            </select>
          </div>

          <div class="col-md-8 mb-3">
            <label class="form-label">Nome</label>
            <input type="text" name="nome" class="form-control" [(ngModel)]="modelo.nome" required />
          </div>

          <div class="col-md-6 mb-3">
            <label class="form-label">E-mail</label>
            <input type="email" name="email" class="form-control" [(ngModel)]="modelo.email" required />
          </div>

          <div class="col-md-6 mb-3">
            <label class="form-label">Telefone</label>
            <input type="text" name="telefone" class="form-control" [(ngModel)]="modelo.telefone" />
          </div>

          <div class="col-md-6 mb-3">
            <label class="form-label">Data de Cadastro</label>
            <input type="date" name="dataCadastro" class="form-control" [(ngModel)]="modelo.dataCadastro" required />
          </div>

          <div class="col-md-6 mb-3">
            <label class="form-label">Status</label>
            <select class="form-select" name="ativo" [(ngModel)]="modelo.ativo" required>
              <option [ngValue]="true">Ativo</option>
              <option [ngValue]="false">Inativo</option>
            </select>
          </div>

          <div class="col-md-12 mb-3">
            <label class="form-label">Observações</label>
            <textarea name="observacoes" class="form-control" [(ngModel)]="modelo.observacoes" rows="3"></textarea>
          </div>
        </div>

        <div class="text-end">
          <button class="btn btn-primary" type="submit">Salvar</button>
          <button class="btn btn-secondary ms-2" type="button" (click)="cancelar()">Cancelar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Tabela -->
  <div class="card">
    <div class="card-header">Lista de Usuários</div>
    <div class="card-body">
      <div class="table-responsive">
        <table class="table table-hover align-middle">
          <thead>
            <tr>
              <th>Tipo</th>
              <th>Nome</th>
              <th>E-mail</th>
              <th>Telefone</th>
              <th>Status</th>
              <th class="text-end">Ações</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let u of displayedUsuarios">
              <td>{{ u.tipo === TipoUsuario.Administrador ? 'Administrador' : 'Operador' }}</td>
              <td>{{ u.nome }}</td>
              <td>{{ u.email }}</td>
              <td>{{ u.telefone }}</td>
              <td>
                <span class="badge" [ngClass]="{ 'bg-success': u.ativo, 'bg-secondary': !u.ativo }">
                  {{ u.ativo ? 'Ativo' : 'Inativo' }}
                </span>
              </td>
              <td class="text-end">
                <button class="btn btn-sm btn-outline-secondary me-1" (click)="abrirModalDetalhes(u)" title="Visualizar">
                  <i class="bi bi-eye-fill"></i>
                </button>
                <button class="btn btn-sm btn-outline-primary me-1" (click)="editarUsuario(u)" title="Editar">
                  <i class="bi bi-pencil-fill"></i>
                </button>
                <button class="btn btn-sm btn-outline-danger" (click)="excluirUsuario(u.id!)" title="Excluir">
                  <i class="bi bi-trash-fill"></i>
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <ngb-pagination [collectionSize]="collectionSize" [(page)]="page" [pageSize]="pageSize"
        (pageChange)="refreshUsuarios()"></ngb-pagination>
    </div>
  </div>

  <!-- Modal Detalhes -->
  <ng-template #modalDetalhes>
    <div class="modal-header">
      <h5 class="modal-title">Detalhes do Usuário</h5>
      <button type="button" class="btn-close" aria-label="Close" (click)="modalService.dismissAll()"></button>
    </div>
    <div class="modal-body">
      <ul class="list-group list-group-flush">
        <li class="list-group-item">
          <strong>Tipo:</strong>
          {{ usuarioSelecionado?.tipo === TipoUsuario.Administrador ? 'Administrador' : 'Operador' }}
        </li>
        <li class="list-group-item"><strong>Nome:</strong> {{ usuarioSelecionado?.nome }}</li>
        <li class="list-group-item"><strong>Email:</strong> {{ usuarioSelecionado?.email }}</li>
        <li class="list-group-item"><strong>Telefone:</strong> {{ usuarioSelecionado?.telefone }}</li>
        <li class="list-group-item"><strong>Status:</strong> {{ usuarioSelecionado?.ativo ? 'Ativo' : 'Inativo' }}</li>
        <li class="list-group-item"><strong>Observações:</strong> {{ usuarioSelecionado?.observacoes }}</li>
      </ul>
    </div>
  </ng-template>
</div>
